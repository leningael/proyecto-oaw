<?php include 'config/bd.php';$sql=$conexion->prepare("SELECT DISTINCT categoria FROM feeds");$sql->execute();$listaCategorias=$sql->fetchAll(PDO::FETCH_ASSOC);$cantArticulos=8;$mayorNoticias=0;if(!$_GET){header('Location:index.php?pagina=1');}if($_GET['pagina']<1){header('Location:index.php?pagina=1');} ?><!doctypehtml><html lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1"name="viewport"><meta content="Noticias más recientes de los feeds agregados en el sito web"name="description"><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"rel="stylesheet"crossorigin="anonymous"integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"><link href="index.css"rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"rel="stylesheet"><title>Lector de Feeds</title></head><body><?php include('layouts/header.php'); ?><div class="container-fluid flex-nowrap"><div class="row"><?php include('layouts/sidebar.php'); ?><div class="col"><section class="mt-4"><div class="container"><div class="row"><div class="col-lg-6"><h1>Noticias de hoy</h1><p class="lead">Las últimas noticias de tus feeds</p></div><div class="col-lg-6"><div class="h-100 align-items-lg-center align-items-start d-flex flex-column flex-md-row justify-content-lg-end mb-2"><a class="btn btn-primary me-2 my-1"href="scripts/actualizarNoticias.php"id="refreshNews"><div class="me-1 align-text-top d-inline-block sprite sprite-actualizar"></div>Actualizar</a></div></div></div><?php foreach($listaCategorias as $categoria){$sentenciaSQL=$conexion->prepare("SELECT COUNT(*) FROM (SELECT id FROM feeds WHERE categoria = '".$categoria['categoria']."') f JOIN (SELECT * FROM noticias WHERE LEFT(fecha, 10) = CURDATE()) n ON n.id_feed=f.id");$sentenciaSQL->execute();$cantidadNoticias=$sentenciaSQL->fetch();if($cantidadNoticias[0]>$mayorNoticias){$mayorNoticias=$cantidadNoticias[0];}$iniciar=($_GET['pagina']-1)*$cantArticulos;$sentenciaSQL=$conexion->prepare("SELECT n.* FROM (SELECT id FROM feeds WHERE categoria = '".$categoria['categoria']."') f JOIN (SELECT * FROM noticias WHERE LEFT(fecha, 10) = CURDATE()) n ON n.id_feed=f.id ORDER BY fecha DESC LIMIT :iniciar, :cantArticulos");$sentenciaSQL->bindParam(':iniciar',$iniciar,PDO::PARAM_INT);$sentenciaSQL->bindParam(':cantArticulos',$cantArticulos,PDO::PARAM_INT);$sentenciaSQL->execute();if($sentenciaSQL->rowCount()>0){$listaNoticias=$sentenciaSQL->fetchAll(PDO::FETCH_ASSOC); ?><div class="row"><div class="col"><h2><?php echo $categoria['categoria'] ?></h2></div></div><div class="row"id="newsSpace"><?php foreach($listaNoticias as $noticia){ ?><div class="col-lg-4 col-md-6 col-per col-xxl-3 mb-4"><button class="h-100 opnButton text-dark text-decoration-none"id="<?php echo $noticia['id']; ?>"style="background-color:transparent;border-color:transparent"><div class="h-100 card"><img alt="Foto noticia"class="card-img-top"src="<?php echo $noticia['imagen']; ?>"><div class="card-body"><p class="h5"class="card-title"><?php echo $noticia['titulo']; ?></p><?php $sentenciaSQL=$conexion->prepare("SELECT * FROM feeds WHERE id = :idFeed");$sentenciaSQL->bindParam(':idFeed',$noticia['id_feed']);$sentenciaSQL->execute();$feed=$sentenciaSQL->fetch(PDO::FETCH_LAZY); ?><a class="me-1 text-decoration-none"href="<?php echo $feed['linkFeed']; ?>"><?php echo $feed['nombre']; ?></a><small><?php date_default_timezone_set('America/Mexico_City');$fechaActual=date("Y-m-d H:i:s");$fechaNoticia=$noticia['fecha'];$datetime1=date_create($fechaNoticia);$datetime2=date_create($fechaActual);$intervalo=date_diff($datetime1,$datetime2);$diasAntiguedad=$intervalo->format('%a');$horasAntiguedad=$intervalo->format('%h');if($diasAntiguedad>1){$differenceFormat='hace %d días';}else if($diasAntiguedad==1){$differenceFormat='Ayer';}else{if($horasAntiguedad>1){$differenceFormat='hace %h horas';}else if($horasAntiguedad==1){$differenceFormat='hace %h hora';}else{$differenceFormat='hace %i minutos';}}echo $intervalo->format($differenceFormat); ?></small></div></div></button></div><?php } ?></div><?php }} ?></div></section><?php $paginas=$mayorNoticias/$cantArticulos;$paginas=ceil($paginas); ?><?php if($paginas>=1){ ?><div class="d-flex align-items-center flex-wrap justify-content-center my-4"><p class="me-4">Página<?php echo " ".$_GET['pagina']." "; ?>de<?php echo " ".$paginas; ?></p><nav aria-label="Page navigation example"><ul class="pagination"><li class="page-item<?php echo $_GET['pagina']<=1?' disabled':''; ?>"><a class="page-link"href="index.php?pagina=<?php echo $_GET['pagina']-1; ?>">Anterior</a></li><li class="page-item<?php echo $_GET['pagina']>=$paginas?' disabled':''; ?>"><a class="page-link"href="index.php?pagina=<?php echo $_GET['pagina']+1; ?>">Siguiente</a></li></ul></nav></div><?php } ?></div></div></div><?php include('layouts/modal.php') ?><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"crossorigin="anonymous"integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"></script><script src="js/index.js"></script></body></html>